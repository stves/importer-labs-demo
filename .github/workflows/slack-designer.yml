name: Slack-Designer
on:
  workflow_dispatch:
jobs:
  build:
    runs-on:
      - ubuntu-latest
    steps:
    - uses: rtCamp/action-slack-notify@v2.2.0
      env:
        SLACK_WEBHOOK: "${{ secrets.SLACK_WEBHOOK }}"
        SLACK_CHANNEL: "${{ secrets.SLACK_CHANNEL }}"
        SLACK_MESSAGE: Default Custom Message
    - name: checkout
      uses: actions/checkout@v3.5.0
    - name: run command
      shell: bash
      run: |-
        echo "henlo"
        mkdir -p artifacts
        echo 'This is an artifact' >> artifacts/one.txt
    - name: run command
      shell: bash
      run: sleep 5
    - name: run command
      shell: bash
      run: |-
        mkdir -p artifacts
        echo 'This is from another build step' >> artifacts/two.txt
        exit 0
    - name: run ansible playbook
      shell: bash
      run: |-
        ansible-playbook playbook playbook/path -i "dynamic_inventory
        test
        with
        newlines" --vault-password-file 9daec9c6-c88d-4392-9d61-f22a8a081362 -U sudo_user --become-user root -l host subset -t tags_to_run --skipped-tags tags_to_skip --start-at-task task_to_start -f 5 -e "key1='val1' key2='val2' key3='val3 with \n newline char'"
      env:
        ANSIBLE_HOST_KEY_CHECKING: true
        ANSIBLE_FORCE_COLOR: true
        PYTHONUNBUFFERED: true
    - id: last_build_status
      uses: actions/github-script@v6.4.0
      if: always()
      with:
        result-encoding: string
        script: |-
          currentWorkflowId = (
            await github.rest.actions.getWorkflowRun({
              owner: context.repo.owner,
              repo: context.repo.repo,
              run_id: context.runId,
            })
          ).data.workflow_id
          runsList = await github.rest.actions.listWorkflowRuns({
            owner: context.repo.owner,
            repo: context.repo.repo,
            workflow_id: currentWorkflowId,
            status: 'completed',
            branch: '${{ env.BRANCH_NAME }}',
            per_page: 1
          });
          return runsList.data.workflow_runs[0].conclusion
    - uses: rtCamp/action-slack-notify@v2.2.0
      if: success()
      env:
        SLACK_WEBHOOK: "${{ secrets.SLACK_WEBHOOK }}"
        SLACK_CHANNEL: "${{ secrets.SLACK_CHANNEL }}"
        SLACK_MESSAGE: Custom Success Message
        SLACK_COLOR: success
    - uses: rtCamp/action-slack-notify@v2.2.0
      if: failure() && steps.last_build_status.outputs.result == 'success'
      env:
        SLACK_WEBHOOK: "${{ secrets.SLACK_WEBHOOK }}"
        SLACK_CHANNEL: "${{ secrets.SLACK_CHANNEL }}"
        SLACK_MESSAGE: 'Custom Failure Message :sad:'
        SLACK_COLOR: failure
    - uses: rtCamp/action-slack-notify@v2.2.0
      if: cancelled()
      env:
        SLACK_WEBHOOK: "${{ secrets.SLACK_WEBHOOK }}"
        SLACK_CHANNEL: "${{ secrets.SLACK_CHANNEL }}"
        SLACK_MESSAGE: Custom Cancelled Message
        SLACK_COLOR: cancelled
    - uses: actions/upload-artifact@v3.1.1
      with:
        path: artifacts/
